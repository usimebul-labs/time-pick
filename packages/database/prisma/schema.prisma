generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum EventType {
  monthly
  weekly
}

model Profile {
  id          String   @id @default(uuid())
  email       String?
  fullName    String?  @map("full_name")
  avatarUrl   String?  @map("avatar_url")
  createdAt   DateTime @default(now()) @map("created_at")
  hostedEvents Event[]
  participations Participant[]
  @@map("profiles")
}

model Event {
  id           String    @id @default(uuid())
  hostId       String?   @map("host_id")
  title        String
  description  String?
  type         EventType @default(monthly) @map("event_type")
  startDate    DateTime  @db.Date @map("start_date")
  endDate      DateTime  @db.Date @map("end_date")
  startTime    DateTime? @db.Time @map("start_time")
  endTime      DateTime? @db.Time @map("end_time")
  excludedDays Int[]     @default([]) @map("excluded_days")
  deadline     DateTime? @map("deadline")
  isConfirmed  Boolean   @default(false) @map("is_confirmed")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @default(now()) @map("updated_at")
  host          Profile? @relation(fields: [hostId], references: [id])
  participants  Participant[]
  availabilities Availability[]
  confirmation  EventConfirmation?
  @@map("events")
}

model EventConfirmation {
  id             String   @id @default(uuid())
  eventId        String   @unique @map("event_id")
  startAt        DateTime @map("start_at")
  endAt          DateTime @map("end_at")
  message        String?
  participantIds String[] @map("participant_ids")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @default(now()) @updatedAt @map("updated_at")
  event          Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_confirmations")
}

model Participant {
  id        String   @id @default(uuid())
  eventId   String   @map("event_id")
  userId    String?  @map("user_id")
  name      String
  guestPin  String?  @map("guest_pin")
  comment   String?
  createdAt DateTime @default(now()) @map("created_at")
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      Profile? @relation(fields: [userId], references: [id])
  availabilities Availability[]
  @@unique([eventId, userId])
  @@map("participants")
}

model Availability {
  id            BigInt   @id @default(autoincrement())
  eventId       String   @map("event_id")
  participantId String   @map("participant_id")
  slot          DateTime @db.Timestamptz
  event       Event       @relation(fields: [eventId], references: [id], onDelete: Cascade)
  participant Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)
  @@index([eventId, slot])
  @@map("availabilities")
}